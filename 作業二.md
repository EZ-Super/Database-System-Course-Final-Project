# 目錄
- [用戶管理](#用戶管理)
      - [以SQL語法描述資料庫Schema](##以SQL語法描述資料庫Schema)
      - [舉例說明](##舉例說明)
# 用戶管理
## 以SQL語法描述資料庫Schema
```sql
-- 會員等級表
CREATE TABLE membership_levels (
    level_id INT AUTO_INCREMENT PRIMARY KEY,
    level_name VARCHAR(255) NOT NULL,
    required_points INTEGER NOT NULL,
    discount_rate DECIMAL(5,2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 使用者表
CREATE TABLE users (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(255) NOT NULL UNIQUE,
    email VARCHAR(255) NOT NULL UNIQUE,
    phone VARCHAR(20),
    password VARCHAR(255) NOT NULL,
    registration_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE,
    membership_level_id INTEGER,
    shipping_address VARCHAR(255),
    billing_address VARCHAR(255),
    FOREIGN KEY (membership_level_id) REFERENCES membership_levels(level_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 賣家表
CREATE TABLE sellers (
    seller_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INTEGER NOT NULL UNIQUE,
    store_name VARCHAR(255) NOT NULL,
    store_description TEXT,
    bank_account VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 點數表
CREATE TABLE points (
    point_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INTEGER NOT NULL,
    points_earned INTEGER,
    transaction_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    description VARCHAR(255),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 優惠券表
CREATE TABLE coupons (
    coupon_id INT AUTO_INCREMENT PRIMARY KEY,
    coupon_code VARCHAR(255) NOT NULL UNIQUE,
    discount_amount DECIMAL(10,2) NOT NULL,
    expiry_date DATE,
    usage_limit INTEGER,
    is_active BOOLEAN DEFAULT TRUE,
    coupon_type ENUM('single_use', 'multi_use_limited') NOT NULL DEFAULT 'single_use',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 訊息表
CREATE TABLE messages (
    message_id INT AUTO_INCREMENT PRIMARY KEY,
    sender_id INTEGER NOT NULL,
    receiver_id INTEGER NOT NULL,
    message_content TEXT NOT NULL,
    send_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_read BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (sender_id) REFERENCES users(user_id),
    FOREIGN KEY (receiver_id) REFERENCES users(user_id),
    INDEX idx_sender (sender_id),
    INDEX idx_receiver (receiver_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 通知表
CREATE TABLE notifications (
    notification_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INTEGER NOT NULL,
    notification_type VARCHAR(50) NOT NULL,
    subject VARCHAR(255) NOT NULL,
    message TEXT NOT NULL,
    sent_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_read BOOLEAN DEFAULT FALSE,
    related_entity VARCHAR(50),
    related_entity_id INTEGER,
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    INDEX idx_user_read (user_id, is_read)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## 舉例說明
### 會員等級與使用者關係
假設我們有以下會員等級資料：
```txt
level_id: 1, level_name: '一般會員', required_points: 0, discount_rate: 0.00
level_id: 2, level_name: '銀牌會員', required_points: 1000, discount_rate: 0.05
level_id: 3, level_name: '金牌會員', required_points: 5000, discount_rate: 0.10
```
以及以下使用者資料：
```txt
user_id: 1, username: 'user001', membership_level_id: 1 (一般會員)
user_id: 2, username: 'user002', membership_level_id: 2 (銀牌會員)
user_id: 3, username: 'user003', membership_level_id: 3 (金牌會員)
```
當使用者 user001 累積足夠的點數升級為銀牌會員時，系統會更新其會員等級：
```sql
UPDATE users SET membership_level_id = 2 WHERE user_id = 1;
```

### 使用者與賣家關係
使用者 user004 申請成為賣家：
```txt
user_id: 4, username: 'seller001', email: 'seller001@example.com'
```
對應的賣家記錄：
```txt
seller_id: 1, user_id: 4, store_name: '優質商店'
```
如果要查詢這個賣家的資訊和對應的使用者資料：
```sql
SELECT u.username, u.email, s.store_name, s.store_description
FROM sellers s
JOIN users u ON s.user_id = u.user_id
WHERE s.seller_id = 1;
```
結果會顯示：
```txt
username: 'seller001', email: 'seller001@example.com', store_name: '優質商店', store_description: '專賣各類優質商品的網路商店'
```

### 點數交易記錄
使用者 user002 進行多次點數交易：
```txt
point_id: 1, user_id: 2, points_earned: 100, description: '購物獲得'
point_id: 2, user_id: 2, points_earned: 50, description: '評價商品獲得'
point_id: 3, user_id: 2, points_earned: -200, description: '兌換優惠券'
```
查詢使用者 user002 的總點數：
```sql
SELECT user_id, SUM(points_earned) as total_points
FROM points
WHERE user_id = 2
GROUP BY user_id;
```
結果顯示：
```txt
user_id: 2, total_points: -50
```

### 訊息發送範例
使用者間的訊息交流：
```txt
message_id: 1, sender_id: 1 (user001), receiver_id: 4 (seller001), message_content: '請問這個商品什麼時候會到貨?', is_read: false
message_id: 2, sender_id: 4 (seller001), receiver_id: 1 (user001), message_content: '下週三會到貨，您可以先預訂', is_read: true
```
查詢使用者 user001 的未讀訊息：
```sql
SELECT m.message_id, u.username as sender, m.message_content, m.send_time
FROM messages m
JOIN users u ON m.sender_id = u.user_id
WHERE m.receiver_id = 1 AND m.is_read = FALSE;
```

### 通知系統範例
當系統向使用者發送不同類型通知：
```txt
notification_id: 1, user_id: 2, notification_type: 'order', subject: '訂單確認', message: '您的訂單 #10001 已確認', related_entity: 'orders', related_entity_id: 10001
notification_id: 2, user_id: 2, notification_type: 'payment', subject: '付款成功', message: '您的訂單 #10001 付款已成功', related_entity: 'payments', related_entity_id: 5001
```
查詢使用者的所有未讀通知：
```sql
SELECT notification_type, subject, message, sent_at
FROM notifications
WHERE user_id = 2 AND is_read = FALSE
ORDER BY sent_at DESC;
```
結果可能顯示：
```txt
notification_type: 'payment', subject: '付款成功', message: '您的訂單 #10001 付款已成功', sent_at: '2023-11-20 14:30:00'
notification_type: 'order', subject: '訂單確認', message: '您的訂單 #10001 已確認', sent_at: '2023-11-20 14:25:00'
```

### 優惠券使用範例
系統中的優惠券：
```txt
coupon_id: 1, coupon_code: 'WELCOME10', discount_amount: 100.00, usage_limit: 1, coupon_type: 'single_use'
coupon_id: 2, coupon_code: 'SUMMER20', discount_amount: 200.00, usage_limit: 3, coupon_type: 'multi_use_limited'
```
當使用者使用優惠券時，可能會直接在訂單表中記錄使用的優惠券，例如：
```sql
-- 在訂單表中記錄使用的優惠券
INSERT INTO orders (user_id, total_amount, coupon_id, discount_amount)
VALUES (2, 1500.00, 2, 200.00);
```
查詢某個優惠券被使用的次數，則可通過查詢訂單表來計算：
```sql
SELECT coupon_id, COUNT(*) as usage_count
FROM orders
WHERE coupon_id = 2
GROUP BY coupon_id;
```
