
# 用戶管理 - 謝延偵
## 以SQL語法描述資料庫Schema 
```sql
-- 會員等級表
CREATE TABLE membership_levels (
    level_id INT AUTO_INCREMENT PRIMARY KEY,
    level_name VARCHAR(255) NOT NULL,
    required_points INTEGER NOT NULL,
    discount_rate DECIMAL(5,2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 使用者表
CREATE TABLE users (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(255) NOT NULL UNIQUE,
    email VARCHAR(255) NOT NULL UNIQUE,
    phone VARCHAR(20),
    password VARCHAR(255) NOT NULL,
    registration_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE,
    membership_level_id INTEGER,
    shipping_address VARCHAR(255),
    billing_address VARCHAR(255),
    FOREIGN KEY (membership_level_id) REFERENCES membership_levels(level_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 賣家表
CREATE TABLE sellers (
    seller_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INTEGER NOT NULL UNIQUE,
    store_name VARCHAR(255) NOT NULL,
    store_description TEXT,
    bank_account VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 點數表
CREATE TABLE points (
    point_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INTEGER NOT NULL,
    points_earned INTEGER,
    transaction_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    description VARCHAR(255),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 優惠券表
CREATE TABLE coupons (
    coupon_id INT AUTO_INCREMENT PRIMARY KEY,
    coupon_code VARCHAR(255) NOT NULL UNIQUE,
    discount_amount DECIMAL(10,2) NOT NULL,
    expiry_date DATE,
    usage_limit INTEGER,
    is_active BOOLEAN DEFAULT TRUE,
    coupon_type ENUM('single_use', 'multi_use_limited') NOT NULL DEFAULT 'single_use',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 訊息表
CREATE TABLE messages (
    message_id INT AUTO_INCREMENT PRIMARY KEY,
    sender_id INTEGER NOT NULL,
    receiver_id INTEGER NOT NULL,
    message_content TEXT NOT NULL,
    send_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_read BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (sender_id) REFERENCES users(user_id),
    FOREIGN KEY (receiver_id) REFERENCES users(user_id),
    INDEX idx_sender (sender_id),
    INDEX idx_receiver (receiver_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 通知表
CREATE TABLE notifications (
    notification_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INTEGER NOT NULL,
    notification_type VARCHAR(50) NOT NULL,
    subject VARCHAR(255) NOT NULL,
    message TEXT NOT NULL,
    sent_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_read BOOLEAN DEFAULT FALSE,
    related_entity VARCHAR(50),
    related_entity_id INTEGER,
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    INDEX idx_user_read (user_id, is_read)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## 舉例說明
### 會員等級與使用者關係
假設我們有以下會員等級資料：
```txt
level_id: 1, level_name: '一般會員', required_points: 0, discount_rate: 0.00
level_id: 2, level_name: '銀牌會員', required_points: 1000, discount_rate: 0.05
level_id: 3, level_name: '金牌會員', required_points: 5000, discount_rate: 0.10
```
以及以下使用者資料：
```txt
user_id: 1, username: 'user001', membership_level_id: 1 (一般會員)
user_id: 2, username: 'user002', membership_level_id: 2 (銀牌會員)
user_id: 3, username: 'user003', membership_level_id: 3 (金牌會員)
```
當使用者 user001 累積足夠的點數升級為銀牌會員時，系統會更新其會員等級：
```sql
UPDATE users SET membership_level_id = 2 WHERE user_id = 1;
```

### 使用者與賣家關係
使用者 user004 申請成為賣家：
```txt
user_id: 4, username: 'seller001', email: 'seller001@example.com'
```
對應的賣家記錄：
```txt
seller_id: 1, user_id: 4, store_name: '優質商店'
```
如果要查詢這個賣家的資訊和對應的使用者資料：
```sql
SELECT u.username, u.email, s.store_name, s.store_description
FROM sellers s
JOIN users u ON s.user_id = u.user_id
WHERE s.seller_id = 1;
```
結果會顯示：
```txt
username: 'seller001', email: 'seller001@example.com', store_name: '優質商店', store_description: '專賣各類優質商品的網路商店'
```

### 點數交易記錄
使用者 user002 進行多次點數交易：
```txt
point_id: 1, user_id: 2, points_earned: 100, description: '購物獲得'
point_id: 2, user_id: 2, points_earned: 50, description: '評價商品獲得'
point_id: 3, user_id: 2, points_earned: -200, description: '兌換優惠券'
```
查詢使用者 user002 的總點數：
```sql
SELECT user_id, SUM(points_earned) as total_points
FROM points
WHERE user_id = 2
GROUP BY user_id;
```
結果顯示：
```txt
user_id: 2, total_points: -50
```

### 訊息發送範例
使用者間的訊息交流：
```txt
message_id: 1, sender_id: 1 (user001), receiver_id: 4 (seller001), message_content: '請問這個商品什麼時候會到貨?', is_read: false
message_id: 2, sender_id: 4 (seller001), receiver_id: 1 (user001), message_content: '下週三會到貨，您可以先預訂', is_read: true
```
查詢使用者 user001 的未讀訊息：
```sql
SELECT m.message_id, u.username as sender, m.message_content, m.send_time
FROM messages m
JOIN users u ON m.sender_id = u.user_id
WHERE m.receiver_id = 1 AND m.is_read = FALSE;
```

### 通知系統範例
當系統向使用者發送不同類型通知：
```txt
notification_id: 1, user_id: 2, notification_type: 'order', subject: '訂單確認', message: '您的訂單 #10001 已確認', related_entity: 'orders', related_entity_id: 10001
notification_id: 2, user_id: 2, notification_type: 'payment', subject: '付款成功', message: '您的訂單 #10001 付款已成功', related_entity: 'payments', related_entity_id: 5001
```
查詢使用者的所有未讀通知：
```sql
SELECT notification_type, subject, message, sent_at
FROM notifications
WHERE user_id = 2 AND is_read = FALSE
ORDER BY sent_at DESC;
```
結果可能顯示：
```txt
notification_type: 'payment', subject: '付款成功', message: '您的訂單 #10001 付款已成功', sent_at: '2023-11-20 14:30:00'
notification_type: 'order', subject: '訂單確認', message: '您的訂單 #10001 已確認', sent_at: '2023-11-20 14:25:00'
```

### 優惠券使用範例
系統中的優惠券：
```txt
coupon_id: 1, coupon_code: 'WELCOME10', discount_amount: 100.00, usage_limit: 1, coupon_type: 'single_use'
coupon_id: 2, coupon_code: 'SUMMER20', discount_amount: 200.00, usage_limit: 3, coupon_type: 'multi_use_limited'
```
當使用者使用優惠券時，可能會直接在訂單表中記錄使用的優惠券，例如：
```sql
-- 在訂單表中記錄使用的優惠券
INSERT INTO orders (user_id, total_amount, coupon_id, discount_amount)
VALUES (2, 1500.00, 2, 200.00);
```
查詢某個優惠券被使用的次數，則可通過查詢訂單表來計算：
```sql
SELECT coupon_id, COUNT(*) as usage_count
FROM orders
WHERE coupon_id = 2
GROUP BY coupon_id;
```

***

# 物流倉儲 - 鍾文瑀
## 以SQL語法描述資料庫Schema
```sql
-- 倉庫管理
CREATE TABLE Warehouses (
    warehouse_id CHAR(36) PRIMARY KEY,
    warehouse_name VARCHAR(100) NOT NULL,
    location VARCHAR(255) NOT NULL,
    capacity INT NOT NULL,
    manager_id CHAR(36),
    contact_info VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (manager_id) REFERENCES Users(user_id)
);

-- 庫存管理
CREATE TABLE Inventory (
    inventory_id CHAR(36) PRIMARY KEY,
    warehouse_id CHAR(36),
    product_id CHAR(36),
    stock_quantity INT DEFAULT 0,
    reorder_level INT DEFAULT 10,
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (warehouse_id) REFERENCES Warehouses(warehouse_id),
    FOREIGN KEY (product_id) REFERENCES Products(product_id)
);

-- 供應商管理
CREATE TABLE Suppliers (
    supplier_id CHAR(36) PRIMARY KEY,
    supplier_name VARCHAR(100) NOT NULL,
    contact_info VARCHAR(255),
    country VARCHAR(50),
    rating INT CHECK (rating BETWEEN 1 AND 5),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 入庫記錄
CREATE TABLE Inbound_Shipments (
    inbound_id CHAR(36) PRIMARY KEY,
    supplier_id CHAR(36),
    warehouse_id CHAR(36),
    product_id CHAR(36),
    quantity INT NOT NULL,
    arrival_date DATE NOT NULL,
    status ENUM('pending', 'received', 'damaged') DEFAULT 'pending',
    FOREIGN KEY (supplier_id) REFERENCES Suppliers(supplier_id),
    FOREIGN KEY (warehouse_id) REFERENCES Warehouses(warehouse_id),
    FOREIGN KEY (product_id) REFERENCES Products(product_id)
);

-- 出庫記錄
CREATE TABLE Outbound_Shipments (
    outbound_id CHAR(36) PRIMARY KEY,
    order_id CHAR(36),
    warehouse_id CHAR(36),
    product_id CHAR(36),
    quantity INT NOT NULL,
    dispatch_date DATE NOT NULL,
    status ENUM('preparing', 'shipped', 'delivered') DEFAULT 'preparing',
    FOREIGN KEY (order_id) REFERENCES Orders(order_id),
    FOREIGN KEY (warehouse_id) REFERENCES Warehouses(warehouse_id),
    FOREIGN KEY (product_id) REFERENCES Products(product_id)
);

-- 訂單管理
CREATE TABLE Orders (
    order_id CHAR(36) PRIMARY KEY,
    customer_name VARCHAR(100) NOT NULL,
    order_status ENUM('pending', 'shipped', 'delivered', 'cancelled') NOT NULL,
    total_amount DECIMAL(10,2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 訂單商品
CREATE TABLE Order_Items (
    order_item_id CHAR(36) PRIMARY KEY,
    order_id CHAR(36),
    product_id CHAR(36),
    quantity INT NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (order_id) REFERENCES Orders(order_id),
    FOREIGN KEY (product_id) REFERENCES Products(product_id)
);

-- 物流配送
CREATE TABLE Shipments (
    shipment_id CHAR(36) PRIMARY KEY,
    order_id CHAR(36),
    tracking_number VARCHAR(50) UNIQUE,
    shipment_status ENUM('preparing', 'shipped', 'delivered') NOT NULL,
    estimated_delivery DATE,
    actual_delivery DATE,
    carrier VARCHAR(50),
    shipping_cost DECIMAL(10,2) DEFAULT 0.00,
    FOREIGN KEY (order_id) REFERENCES Orders(order_id)
);

-- 倉庫內調撥
CREATE TABLE Warehouse_Transfers (
    transfer_id CHAR(36) PRIMARY KEY,
    from_warehouse_id CHAR(36),
    to_warehouse_id CHAR(36),
    product_id CHAR(36),
    quantity INT NOT NULL,
    transfer_status ENUM('pending', 'in_transit', 'completed') DEFAULT 'pending',
    transfer_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (from_warehouse_id) REFERENCES Warehouses(warehouse_id),
    FOREIGN KEY (to_warehouse_id) REFERENCES Warehouses(warehouse_id),
    FOREIGN KEY (product_id) REFERENCES Products(product_id)
);

-- 訂單支付
CREATE TABLE Payments (
    payment_id CHAR(36) PRIMARY KEY,
    order_id CHAR(36),
    payment_method ENUM('credit_card', 'paypal', 'bank_transfer', 'cash_on_delivery') NOT NULL,
    payment_status ENUM('pending', 'completed', 'failed') NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    payment_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES Orders(order_id)
);

-- 退貨與退款
CREATE TABLE Returns_Refunds (
    return_id CHAR(36) PRIMARY KEY,
    order_id CHAR(36),
    product_id CHAR(36),
    reason TEXT,
    status ENUM('requested', 'approved', 'rejected', 'processed') DEFAULT 'requested',
    refund_amount DECIMAL(10,2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES Orders(order_id),
    FOREIGN KEY (product_id) REFERENCES Products(product_id)
);
```
### 舉例說明
### 倉庫管理
情境說明

新增或關閉一個倉庫，通知管理員

欄位說明

warehouse_id：倉庫唯一識別碼

warehouse_name：倉庫名稱

location：倉庫地址

capacity：容量（單位：件）

manager_id：對應管理員

contact_info：聯絡資訊

created_at：建立時間

```sql
INSERT INTO notifications (notification_id, user_id, notification_type, subject, message, related_entity, related_entity_id)
VALUES 
(1, 10, 'warehouse', '新倉庫建立通知', '您已被指派為「倉庫」的管理員', 'warehouses', 'W001');
```
通知記錄模擬

notification_id: 1

user_id: 'user-002'

notification_type: 'warehouse'

subject: '倉庫建立通知'

message: '您已被指派為「倉庫」的管理員'

related_entity: 'warehouses'

related_entity_id: 'wh-001'

```sql
SELECT notification_type, subject, message, sent_at
FROM notifications
WHERE user_id = 10 AND is_read = FALSE
ORDER BY sent_at DESC;
```
查詢結果
| notification_type	| subject	| message	| sent_at |
|------------------|-------------|-----------|------|
| warehouse	| 新倉庫建立通知	| 您已被指派為「倉庫」的管理員	| 2023-11-01 09:00:00 |

### 庫存管理
情境說明

當某倉庫商品數量低於補貨門檻（reorder_level）時，自動通知管理員

欄位說明
```text
inventory_id：唯一標識
warehouse_id：所屬倉庫
product_id：商品識別碼
stock_quantity：當前庫存量
reorder_level：補貨臨界值
last_updated：上次更新時間
```

```sql
INSERT INTO notifications VALUES (2, 11, 'inventory', '低庫存警告', '台北倉庫中的「A書籍」庫存量低於補貨門檻，請及時補貨', 'inventory', 'inv-100');
```
通知記錄模擬

notification_id: 2

user_id: 'user-002'

notification_type: 'inventory'

subject: '庫存警示'

message: '台北倉庫中的「A書籍」庫存量低於補貨門檻，請及時補貨'

related_entity: 'inventory'

related_entity_id: 'inv-001'

```sql
SELECT notification_type, subject, message, sent_at
FROM notifications
WHERE user_id = 11 AND is_read = FALSE
ORDER BY sent_at DESC;
```
查詢結果
| subject	| message	| sent_at |
|----------|-------|-----------|
| 低庫存警告	| 台北倉庫中的「A書籍」庫存量低於補貨門檻，請及時補貨	| 2025-05-06 10:01:00 |

### 供應商管理

情境說明

當新增供應商或供應商評價更新時，系統通知採購或庫存管理人員進行審核或調整策略。

欄位說明

supplier_id：供應商唯一識別碼

supplier_name：名稱

contact_info：聯絡資訊

country：國家

rating：供應商評分（1~5）

created_at：建立時間

```sql
INSERT INTO Suppliers (supplier_id, supplier_name, contact_info, country, rating)
VALUES ('sup-001', '東亞圖書有限公司', 'email:support@eabooks.tw', 'Taiwan', 5);
```
通知記錄模擬

notification_id: 3

user_id: 'user-005'

notification_type: 'supplier'

subject: '新供應商登記'

message: '新供應商「東亞圖書有限公司」已加入系統，請確認其供應能力與評價'

related_entity: 'suppliers'

related_entity_id: 'sup-001'

```sql
SELECT subject, message, sent_at
FROM notifications
WHERE user_id = 'user-005' AND notification_type = 'supplier'
ORDER BY sent_at DESC;
```
模擬查詢結果

| subject | message | sent_at |
|------|-------|------|
| 新供應商登記 | 新供應商「東亞圖書有限公司」已加入系統，請確認其供應能力與評價 | 2025-05-06 09:15:00 |

### 入庫記錄

情境說明

當新供應商的商品入庫並且狀態為 "已接收" 時，系統通知倉庫管理員。

欄位說明

inbound_id：入庫記錄唯一識別碼

supplier_id：供應商識別碼

warehouse_id：倉庫識別碼

product_id：商品識別碼

quantity：入庫數量

arrival_date：到貨日期

status：入庫狀態（pending, received, damaged）

```sql
INSERT INTO Inbound_Shipments (inbound_id, supplier_id, warehouse_id, product_id, quantity, arrival_date)
VALUES ('inb-001', 'sup-001', 'wh-001', 'prod-001', 50, '2025-05-06');
```
通知記錄模擬

notification_id: 4

user_id: 'user-002'

notification_type: 'inbound_shipment'

subject: '商品入庫通知'

message: '來自供應商「東亞圖書有限公司」的「A書籍」已入庫50件，狀態為已接收'

related_entity: 'inbound_shipments'

related_entity_id: 'inb-001'

```sql
SELECT subject, message, sent_at
FROM notifications
WHERE user_id = 'user-002' AND notification_type = 'inbound_shipment'
ORDER BY sent_at DESC;
```
查詢結果
| subject	| message	| sent_at |
|-------|------|------|
| 商品入庫通知	| 來自供應商「東亞圖書有限公司」的「A書籍」已入庫50件，狀態為已接收	| 2025-05-06 10:00:00

### 出庫記錄

情境說明

當訂單商品出庫並發送給客戶時，系統通知倉庫及運輸部門

欄位說明

outbound_id：出庫記錄唯一識別碼

order_id：訂單識別碼

warehouse_id：倉庫識別碼

product_id：商品識別碼

quantity：出庫數量

dispatch_date：發貨日期

status：出庫狀態（preparing, shipped, delivered）

```sql
INSERT INTO Outbound_Shipments (outbound_id, order_id, warehouse_id, product_id, quantity, dispatch_date)
VALUES ('out-001', 'ord-001', 'wh-001', 'prod-001', 2, '2025-05-06');
```
通知記錄模擬

notification_id: 5

user_id: 'user-002'

notification_type: 'outbound_shipment'

subject: '訂單商品已出庫'

message: '訂單 #ord-001 中的「A書籍」已從「台北倉庫」出庫並發貨'

related_entity: 'outbound_shipments'

related_entity_id: 'out-001'

```sql
SELECT subject, message, sent_at
FROM notifications
WHERE user_id = 'user-002' AND notification_type = 'outbound_shipment'
ORDER BY sent_at DESC;
```
查詢結果

| subject	| message	| sent_at |
|------|-------|---------|
| 訂單商品已出庫	| 訂單 #ord-001 中的「A書籍」已從「台北倉庫」出庫並發貨	| 2025-05-06 10:15:00 |



### 訂單商品

情境說明

當訂單商品狀態更新時，系統向訂單負責人發送通知

欄位說明

order_item_id：訂單商品唯一識別碼

order_id：訂單識別碼

product_id：商品識別碼

quantity：商品數量

price：商品價格

```sql
INSERT INTO Order_Items (order_item_id, order_id, product_id, quantity, price)
VALUES ('item-001', 'ord-001', 'prod-001', 2, 750.00);
```
通知記錄模擬

notification_id: 7

user_id: 'user-001'

notification_type: 'order_item'

subject: '訂單商品更新'

message: '訂單 #ord-001 中的「A書籍」已添加 2 件，單價 750 元'

related_entity: 'order_items'

related_entity_id: 'item-001'

```sql
SELECT subject, message, sent_at
FROM notifications
WHERE user_id = 'user-001' AND notification_type = 'order_item'
ORDER BY sent_at DESC;
```
查詢結果

| subject	| message	| sent_at |
|-----|-----|-----|
| 訂單商品更新	| 訂單 #ord-001 中的「A書籍」已添加 2 件，單價 750 元	| 2025-05-06 10:45:00 |

### 物流配送

情境說明

當訂單發貨並生成運單號時，系統向顧客發送訂單追蹤通知

欄位說明

shipment_id：物流配送唯一識別碼

order_id：訂單識別碼

tracking_number：運單號

shipment_status：配送狀態（preparing, shipped, delivered）

estimated_delivery：預計送達日期

actual_delivery：實際送達日期

carrier：承運人

shipping_cost：運費

```sql
INSERT INTO Shipments (shipment_id, order_id, tracking_number, shipment_status, estimated_delivery, carrier, shipping_cost)
VALUES ('ship-001', 'ord-001', 'track-001', 'shipped', '2025-05-07', '快遞公司', 50.00);
```
通知記錄模擬

notification_id: 8

user_id: 'user-003'

notification_type: 'shipment'

subject: '您的訂單已發貨'

message: '您的訂單 #ord-001 已發貨，運單號為 track-001，預計送達日期為 2025-05-07'

related_entity: 'shipments'

related_entity_id: 'ship-001'

```sql
SELECT subject, message, sent_at
FROM notifications
WHERE user_id = 'user-003' AND notification_type = 'shipment'
ORDER BY sent_at DESC;
```
查詢結果

| subject	| message	| sent_at |
|------------|------------|----------|
| 您的訂單已發貨	| 您的訂單 #ord-001 已發貨，運單號為 track-001，預計送達日期為 2025-05-07	| 2025-05-06 11:00:00 |

### 倉庫調撥

情境說明

當倉庫之間進行調撥時，系統向相關負責人發送調撥通知

欄位說明

transfer_id：調撥唯一識別碼

from_warehouse_id：調撥出倉庫識別碼

to_warehouse_id：調撥入倉庫識別碼

product_id：商品識別碼

quantity：調撥數量

transfer_date：調撥日期

status：調撥狀態（pending, completed, cancelled）

```sql
INSERT INTO Warehouse_Transfers (transfer_id, from_warehouse_id, to_warehouse_id, product_id, quantity, transfer_date)
VALUES ('transfer-001', 'wh-001', 'wh-002', 'prod-001', 100, '2025-05-06');
```
通知記錄模擬

notification_id: 9

user_id: 'user-002'

notification_type: 'warehouse_transfer'

subject: '倉庫商品調撥通知'

message: '商品「A書籍」已從「台北倉庫」調撥到「高雄倉庫」，數量為 100 件'

related_entity: 'warehouse_transfers'

related_entity_id: 'transfer-001'

```sql
SELECT subject, message, sent_at
FROM notifications
WHERE user_id = 'user-002' AND notification_type = 'warehouse_transfer'
ORDER BY sent_at DESC;
```
查詢結果

| subject	| message	| sent_at |
|-----|-------|---------|
| 倉庫商品調撥通知	| 商品「A書籍」已從「台北倉庫」調撥到「高雄倉庫」，數量為 100 件 |	2025-05-06 11:15:00 |

###  付款管理

情境說明

當收到顧客付款時，系統會通知財務部門確認並更新付款狀態

欄位說明

payment_id：付款唯一識別碼

order_id：訂單識別碼

payment_date：付款日期

amount：付款金額

payment_method：付款方式（信用卡、轉帳、現金等）

status：付款狀態（pending, completed, failed）

```sql
INSERT INTO Payments (payment_id, order_id, payment_date, amount, payment_method, status)
VALUES ('pay-001', 'ord-001', '2025-05-06', 1500.00, '信用卡', 'completed');
```
通知記錄模擬

notification_id: 10

user_id: 'user-004'

notification_type: 'payment'

subject: '付款成功通知'

message: '顧客「張三」的訂單 #ord-001 已完成付款，金額 1500 元'

related_entity: 'payments'

related_entity_id: 'pay-001'

```sql
SELECT subject, message, sent_at
FROM notifications
WHERE user_id = 'user-004' AND notification_type = 'payment'
ORDER BY sent_at DESC;
```
查詢結果

| subject	| message	| sent_at |
| 付款成功通知	| 顧客「張三」的訂單 #ord-001 已完成付款，金額 1500 元 |	2025-05-06 11:30:00 |

### 退貨與退款通知
情境說明

當顧客申請退貨並處理退款時，系統通知客戶服務部門

欄位說明

return_id：退貨唯一識別碼

order_id：訂單識別碼

product_id：商品識別碼

quantity：退貨數量

return_date：退貨日期

refund_amount：退款金額

status：退貨狀態（pending, approved, rejected）

```sql
INSERT INTO Returns_Refunds (return_id, order_id, product_id, quantity, return_date, refund_amount, status)
VALUES ('return-001', 'ord-001', 'prod-001', 1, '2025-05-06', 750.00, 'approved');
```
通知記錄模擬

notification_id: 11

user_id: 'user-003'

notification_type: 'return_refund'

subject: '退貨退款處理通知'

message: '顧客「張三」的訂單 #ord-001 退貨申請已通過，已退款 750 元'

related_entity: 'returns_refunds'

related_entity_id: 'return-001'

```sql
SELECT subject, message, sent_at
FROM notifications
WHERE user_id = 'user-003' AND notification_type = 'return_refund'
ORDER BY sent_at DESC;
```
查詢結果
| subject	| message	| sent_at |
|----------|---------|---------|
| 退貨退款處理通知 |	顧客「張三」的訂單 #ord-001 退貨申請已通過，已退款 750 元	| 2025-05-06 11:45:00 |

# 數據分析 - 鍾文瑀
## 以SQL語法描述資料庫Schema
```sql
-- 銷售分析
CREATE TABLE Sales_Analysis (
    record_id CHAR(36) PRIMARY KEY,
    date DATE NOT NULL,
    product_id CHAR(36),
    category_id CHAR(36),
    total_sales INT NOT NULL,
    revenue DECIMAL(10,2) NOT NULL,
    average_price DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (product_id) REFERENCES Products(product_id),
    FOREIGN KEY (category_id) REFERENCES Categories(category_id)
);

-- 庫存趨勢
CREATE TABLE Inventory_Analytics (
    record_id CHAR(36) PRIMARY KEY,
    date DATE NOT NULL,
    warehouse_id CHAR(36),
    product_id CHAR(36),
    starting_stock INT NOT NULL,
    ending_stock INT NOT NULL,
    sold_units INT NOT NULL,
    received_units INT NOT NULL,
    FOREIGN KEY (warehouse_id) REFERENCES Warehouses(warehouse_id),
    FOREIGN KEY (product_id) REFERENCES Products(product_id)
);

-- 訂單轉換率
CREATE TABLE Order_Conversion_Stats (
    record_id CHAR(36) PRIMARY KEY,
    date DATE NOT NULL,
    total_visits INT NOT NULL,
    total_orders INT NOT NULL,
    conversion_rate DECIMAL(5,2) NOT NULL
);

-- 物流配送表現
CREATE TABLE Shipment_Performance (
    record_id CHAR(36) PRIMARY KEY,
    date DATE NOT NULL,
    carrier VARCHAR(50) NOT NULL,
    total_shipments INT NOT NULL,
    on_time_deliveries INT NOT NULL,
    late_deliveries INT NOT NULL,
    average_delivery_time INT NOT NULL  -- 單位: 小時
);

-- 顧客滿意度分析
CREATE TABLE Customer_Feedback_Stats (
    record_id CHAR(36) PRIMARY KEY,
    date DATE NOT NULL,
    product_id CHAR(36),
    total_reviews INT NOT NULL,
    average_rating DECIMAL(3,2) NOT NULL,
    positive_reviews INT NOT NULL,
    negative_reviews INT NOT NULL,
    FOREIGN KEY (product_id) REFERENCES Products(product_id)
);
```

### 舉例說明

# 商品管理 & 驗證伺服器 - 楊峻朋
## 以SQL語法描述資料庫Schema
```sql
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    product_name VARCHAR(255) NOT NULL,
    sku VARCHAR(100) NOT NULL UNIQUE,
    brand VARCHAR(100),
    model VARCHAR(100),
    description TEXT,
    category_id INTEGER NOT NULL,
    variant_type VARCHAR(255),
    price NUMERIC(10,2) NOT NULL,
    promotional_price INTEGER,
    promotion_start_date TIMESTAMP,
    promotion_end_date TIMESTAMP,
    stock_quantity INTEGER NOT NULL DEFAULT 0,
    seller_id INTEGER,
    shipping_weight NUMERIC(10,2) DEFAULT 0,
    image_url VARCHAR(255),
    barcode VARCHAR(50),
    reviews_count INTEGER DEFAULT 0,
    favorites_count INTEGER DEFAULT 0,
    date_added TIMESTAMP DEFAULT NOW(),
    last_updated TIMESTAMP DEFAULT NOW(),
    
    FOREIGN KEY (category_id) REFERENCES categories(category_id),
    FOREIGN KEY (seller_id) REFERENCES sellers(seller_id)
);


CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    sAMAccountName VARCHAR(255) NOT NULL UNIQUE, -- 帳號 (AD 帳戶名)
    mail VARCHAR(255) UNIQUE,                    -- 使用者電子郵件
    department VARCHAR(255),                     -- 所屬部門
    title VARCHAR(255),                          -- 職稱
    physicalDeliveryOfficeName VARCHAR(255),     -- 辦公室
    accountEnabled BOOLEAN NOT NULL DEFAULT TRUE,-- 啟用帳戶
    pwdLastSet BIGINT,                           -- 密碼上次設定時間
    organizationalUnit VARCHAR(255),             -- 組織單元
    manager INTEGER,                             -- 上級主管 ID
    whenCreated TIMESTAMP DEFAULT NOW(),         -- 建立帳戶時間
    whenChanged TIMESTAMP DEFAULT NOW(),         -- 上次修改時間
    userAccountControl INTEGER DEFAULT 512,      -- 使用者帳戶控制碼 (預設為一般帳號)
    jwt VARCHAR(255),                            -- JWT 權杖
    loginStatus VARCHAR(50) DEFAULT '未登入',    -- 登入狀態
    password_hash VARCHAR(255) NOT NULL,             -- 密碼雜湊

    FOREIGN KEY (manager) REFERENCES users(user_id)
);

CREATE TABLE login_logs (
    login_id SERIAL PRIMARY KEY,
    user_id INTEGER,
    login_time TIMESTAMP NOT NULL DEFAULT NOW(),
    ip_address VARCHAR(45) NOT NULL,
    success BOOLEAN,
    jwt VARCHAR(255) NOT NULL, 

    FOREIGN KEY (user_id) REFERENCES users(user_id)
);

CREATE TABLE reviews (
    review_id SERIAL PRIMARY KEY,
    product_id INTEGER,
    user_id INTEGER,
    rating INTEGER NOT NULL,
    comment TEXT NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),

    FOREIGN KEY (product_id) REFERENCES products(product_id),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);

CREATE TABLE categories (
    category_id SERIAL PRIMARY KEY,
    category_name VARCHAR(255) NOT NULL UNIQUE,
    category_description TEXT
);

```
### 舉例說明
* 商品刊登範例
    * 如果我們需要刊登以下商品
```sql
INSERT INTO products (
    product_name, sku, brand, model, description, category_id,
    variant_type, price, promotional_price, promotion_start_date, promotion_end_date,
    stock_quantity, seller_id, shipping_weight, image_url, barcode,
    reviews_count, favorites_count
) VALUES (
    '無線藍牙耳機',                   -- product_name
    'BT-123456',                      -- sku
    '音你而來科技',                  -- brand
    'YNY-BT01',                       -- model
    '高音質藍牙5.2耳機，支援降噪與快充', -- description
    1,                                -- category_id（需已存在於 categories 表）
    '黑色款',                         -- variant_type
    1299.00,                          -- price
    999,                              -- promotional_price
    '2025-05-01 00:00:00',            -- promotion_start_date
    '2025-05-10 23:59:59',            -- promotion_end_date
    500,                              -- stock_quantity
    2,                                -- seller_id（需已存在於 sellers 表）
    0.15,                             -- shipping_weight (kg)
    'https://example.com/images/bt01.jpg', -- image_url
    '4712345678901',                  -- barcode
    0,                                -- reviews_count
    0                                 -- favorites_count
);

```

* 登入驗證
```sql
SELECT *
FROM users
WHERE sAMAccountName = 'jack.liu'
  AND password_hash = SHA2('user_password', 256)
  AND accountEnabled = TRUE;
```
* 登入紀錄

```sql
INSERT INTO login_logs (
    user_id,
    ip_address,
    success,
    jwt_token
) VALUES (
    1,
    '192.168.1.101',
    TRUE,
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxfQ.vNwnB6u1RUQQgQJ...'
);

```

* 購買評論
    * product_id = 3 是「無線滑鼠」
    * user_id = 1 是「王小明」
```sql
INSERT INTO reviews (
    product_id,
    user_id,
    rating,
    comment
) VALUES (
    3,
    1,
    5,
    '非常好用，推薦！'
);
```


# 訂單管理 - 李維誠
## 以SQL語法描述資料庫Schema

```sql
-- orders 訂單表
CREATE TABLE orders (
  order_id       INTEGER AUTO_INCREMENT PRIMARY KEY,
  customer_id    INTEGER NOT NULL,
  order_status   ENUM('pending', 'shipped', 'delivered', 'cancelled') NOT NULL,
  total_amount   NUMERIC(10,2) NOT NULL,
  created_at     TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at     TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  shipping_fee   NUMERIC(10,2) DEFAULT 0,
  discount       NUMERIC(10,2) DEFAULT 0,
  payment_id     INTEGER,
  shipping_id    INTEGER,
  coupon_id      INTEGER,

  FOREIGN KEY (customer_id) REFERENCES users(user_id),
  FOREIGN KEY (payment_id) REFERENCES payments(payment_id),
  FOREIGN KEY (shipping_id) REFERENCES shipments(shipment_id),
  FOREIGN KEY (coupon_id) REFERENCES coupons(coupon_id)
);

-- order_items 訂單品項表
CREATE TABLE order_items (
  order_item_id  INTEGER AUTO_INCREMENT PRIMARY KEY,
  order_id       INTEGER,
  product_id     INTEGER NOT NULL,
  quantity       INTEGER NOT NULL,
  unit_price     NUMERIC(10,2) NOT NULL,
  subtotal       NUMERIC(10,2) AS (quantity * unit_price) STORED,

  FOREIGN KEY (order_id) REFERENCES orders(order_id),
  FOREIGN KEY (product_id) REFERENCES products(product_id)
);

-- payments 付款表
CREATE TABLE payments (
  payment_id       INTEGER AUTO_INCREMENT PRIMARY KEY,
  order_id         INTEGER,
  payment_method   ENUM('credit_card', 'paypal', 'bank_transfer', 'cash_on_delivery') NOT NULL,
  payment_status   ENUM('pending', 'completed', 'failed') NOT NULL,
  amount           NUMERIC(10,2) NOT NULL,
  payment_date     TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (order_id) REFERENCES orders(order_id)
);

-- return_refunds 退貨退款表
CREATE TABLE return_refunds (
  refund_id      INTEGER AUTO_INCREMENT PRIMARY KEY,
  order_id       INTEGER,
  product_id     INTEGER,
  reason         TEXT,
  status         ENUM('requested', 'approved', 'rejected', 'processed') DEFAULT 'requested',
  refund_amount  NUMERIC(10,2),
  created_at     TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (order_id) REFERENCES orders(order_id),
  FOREIGN KEY (product_id) REFERENCES products(product_id)
);

```
